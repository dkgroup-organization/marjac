<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <template id="report_saleorder_inherited" inherit_id="sale.report_saleorder_document">

            <xpath expr="//p[@t-if='doc.partner_id.vat']" position="replace">
                <p t-if="doc.partner_id.ice" class="m-0"><t t-esc="'ICE'"/>: <span t-field="doc.partner_id.ice"/></p>
                <p t-if="doc.partner_id.rc"><t t-esc="'RC'"/>: <span t-field="doc.partner_id.rc"/></p>
            </xpath>

            <xpath expr="//t[@t-set='address']" position="before">
                <p class="m-0" t-if="doc.equipment_id"><b><t t-esc="'Equipement'"/>: </b><span t-field="doc.equipment_id.name"/></p>
                <p class="mt-0 mb-2" t-if="doc.serial_num"><b><t t-esc="'N° de série'"/>: </b><span t-field="doc.serial_num"/></p>
            </xpath>

            <xpath expr="//table[@class='table table-sm o_main_table']" position="replace">
                <style>
                table, th, td, tr {
                    border: 1px solid black;
                    border-collapse: collapse;
                }
				
				.o_report_layout_striped .table {
					border-top: 1px solid black;
				}
                </style>
                <table class="table table-sm o_main_table">
                <!-- In case we want to repeat the header, remove "display: table-row-group" -->
                <thead style="display: table-row-group">
                    <tr>
                        <th name="th_description" class="text-left">Description</th>
                        <th name="th_quantity" class="text-right">Quantity</th>
                        <th name="th_priceunit" class="text-right">Unit Price</th>
                        <th name="th_discount" t-if="display_discount" class="text-right" groups="product.group_discount_per_so_line">
                            <span>Disc.%</span>
                        </th>
                        <th name="th_taxes" class="text-right">Taxes</th>
                        <th name="th_subtotal" class="text-right">
                            <span groups="account.group_show_line_subtotals_tax_excluded">Amount</span>
                            <span groups="account.group_show_line_subtotals_tax_included">Total Price</span>
                        </th>
                    </tr>
                </thead>
                <tbody class="sale_tbody">

                    <t t-set="current_subtotal" t-value="0"/>

                    <t t-foreach="doc.order_line" t-as="line">

                        <t t-set="current_subtotal" t-value="current_subtotal + line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                        <t t-set="current_subtotal" t-value="current_subtotal + line.price_total" groups="account.group_show_line_subtotals_tax_included"/>

                        <tr t-att-class="'bg-200 font-weight-bold o_line_section' if line.display_type == 'line_section' else 'font-italic o_line_note' if line.display_type == 'line_note' else ''">
                            <t t-if="not line.display_type">
                                <td name="td_name"><span t-field="line.name"/></td>
                                <td name="td_quantity" class="text-right">
                                    <span t-field="line.product_uom_qty"/>
                                    <span t-field="line.product_uom"/>
                                </td>
                                <td name="td_priceunit" class="text-right">
                                    <span t-field="line.price_unit"/>
                                </td>
                                <td t-if="display_discount" class="text-right" groups="product.group_discount_per_so_line">
                                    <span t-field="line.discount"/>
                                </td>
                                <td name="td_taxes" class="text-right">
                                    <span t-esc="', '.join(map(lambda x: (x.description or x.name), line.tax_id))"/>
                                </td>
                                <td name="td_subtotal" class="text-right o_price_total">
                                    <span t-field="line.price_subtotal" groups="account.group_show_line_subtotals_tax_excluded"/>
                                    <span t-field="line.price_total" groups="account.group_show_line_subtotals_tax_included"/>
                                </td>
                            </t>
                            <t t-if="line.display_type == 'line_section'">
                                <td name="td_section_line" colspan="99">
                                    <span t-field="line.name"/>
                                </td>
                                <t t-set="current_section" t-value="line"/>
                                <t t-set="current_subtotal" t-value="0"/>
                            </t>
                            <t t-if="line.display_type == 'line_note'">
                                <td name="td_note_line" colspan="99">
                                    <span t-field="line.name"/>
                                </td>
                            </t>
                        </tr>

                        <t t-if="current_section and (line_last or doc.order_line[line_index+1].display_type == 'line_section')">
                            <tr class="is-subtotal text-right">
                                <td name="td_section_subtotal" colspan="99">
                                    <strong class="mr16">Subtotal</strong>
                                    <span
                                        t-esc="current_subtotal"
                                        t-options='{"widget": "monetary", "display_currency": doc.pricelist_id.currency_id}'
                                    />
                                </td>
                            </tr>
                        </t>
                    </t>
                </tbody>
            </table>
            </xpath>


        </template>
		
		<template id="external_layout_striped_inherited" inherit_id="web.external_layout_striped">
		
			<xpath expr="//div[@t-attf-class='o_company_#{company.id}_layout header']" position="replace">
				<style>
                <!-- .pointer>p>span { -->
                    <!-- font-size: 19px !important; -->
                <!-- } -->
                </style>
                <div t-attf-class="o_company_#{company.id}_layout header" t-att-style="report_header_style">
					<div class="o_background_header">
					<div class="float-right">
						<h3 class="mt0 text-right m-auto" t-field="company.report_header"/>
					</div>
					<img t-if="company.logo" t-att-src="image_data_uri(company.logo)" class="float-left" alt="Logo" style="width:1400px !important; height:600px; max-height: 96px !important; max-width: 350px !important; "/>
					<div class="">
						<div class="float-right company_address col-5" style="margin-top: 20px !important; margin-left: 20px !important;">
							<span t-if="company.company_details" t-field="company.company_details" class="pointer"></span>
						</div>
					</div>
					<div class="clearfix mb8"/>
					</div>
				</div>
            </xpath>
			
		</template>
		
		<template id="document_tax_totals_inherited" inherit_id="account.document_tax_totals">
			<xpath expr="//tr[@class='border-black o_subtotal']" position="replace">
			<style>
				.o_report_layout_striped div#total table tr.o_total td {
					border-top: 1px solid black !important;
				}
			</style>
				<tr class="border-black o_subtotal" bgcolor="red" style="background-color:red; !important">
                    <td bgcolor="red" style="background-color:#D5CABD; !important"><strong t-esc="subtotal['name']"/></td>

                    <td class="text-right" bgcolor="red" style="background-color:#D5CABD; !important">
                        <span
                            t-att-class="oe_subtotal_footer_separator"
                            t-esc="subtotal['formatted_amount']" style="color:black !important;"
                        />
                    </td>
                </tr>
			</xpath>
			
			<xpath expr="//tr[@class='border-black o_total']" position="replace">
				<tr class="border-black o_total">
                <td style="background-color:#0081CF; !important"><strong>Total</strong></td>
                <td class="text-right" style="background-color:#0081CF; !important">
                    <span t-esc="tax_totals['formatted_amount_total']" style="color:black !important;"/>
                </td>
            </tr>
			</xpath>
			
		</template>
		
    </data>
</odoo>
